<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <title>Vanilla JavaScript App</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
</head>

<body>
  <main>
    <h1>Chat static Azure test</h1>

    <input placeholder="pseudo" type="text" id="pseudo"/>
    <input placeholder="message" type="text" id="message"/>
    <button id="sendmessage">Send Message</button>
    <br>
    <button id="getmessage">Get Message</button>
    <br><br>
    <div id="messages"></div>
  </main>

  <script>
    $(document).ready(function(){
      $("#sendmessage").click(function(){
        $.ajax({
            url: "https://fnctest0001.azurewebsites.net/api/HttpTrigger1",
            type: "POST",
            dataType: "json",
            data: JSON.stringify( { 
              "pseudo": $("#pseudo").val(),
              "name": $("#message").val(),
            } ),
            contentType: "application/json"
        }); 
      });

      $("#getmessage").click(function(){
        $.ajax({
            url: "https://fnctest0001.azurewebsites.net/api/HttpTrigger3",
            type: "POST",
            dataType: "json",
            contentType: "application/json"
        }).done(function (res) {
            let messages = "";
            for (let i in res) {
                messages += (new Date(res[i]._ts*1000)).toLocaleDateString()+" ";
                messages += (new Date(res[i]._ts*1000)).toLocaleTimeString()+" - ";
                messages += res[i].pseudo+": ";
                messages += res[i].name+"<br><br>";
            }
            $("#messages").html(messages);

        }); 
      });
    });
  </script>
</body>

</html>